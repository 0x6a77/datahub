(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{138:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return u}));var a=n(163),i=n(164),r=(n(0),n(165)),o={title:"Developing on Metadata Ingestion",hide_title:!0,slug:"/metadata-ingestion/developing",custom_edit_url:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/developing.md"},l={unversionedId:"metadata-ingestion/developing",id:"metadata-ingestion/developing",isDocsHomePage:!1,title:"Developing on Metadata Ingestion",description:"Developing on Metadata Ingestion",source:"@site/genDocs/metadata-ingestion/developing.md",slug:"/metadata-ingestion/developing",permalink:"/docs/metadata-ingestion/developing",editUrl:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/developing.md",version:"current",sidebar:"overviewSidebar",previous:{title:"MetadataChangeEvent (MCE) Consumer Job",permalink:"/docs/metadata-jobs/mce-consumer-job"},next:{title:"Aspect Versioning",permalink:"/docs/advanced/aspect-versioning"}},s=[{value:"Architecture",id:"architecture",children:[]},{value:"Getting Started",id:"getting-started",children:[{value:"Requirements",id:"requirements",children:[]},{value:"Set up your Python environment",id:"set-up-your-python-environment",children:[]},{value:"Common setup issues",id:"common-setup-issues",children:[]},{value:"Using Plugins in Development",id:"using-plugins-in-development",children:[]}]},{value:"Code layout",id:"code-layout",children:[]},{value:"Contributing",id:"contributing",children:[{value:"Testing",id:"testing",children:[]},{value:"Sanity check code before committing",id:"sanity-check-code-before-committing",children:[]}]}],c={rightToc:s};function u(e){var t=e.components,o=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},c,o,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"developing-on-metadata-ingestion"},"Developing on Metadata Ingestion"),Object(r.b)("p",null,"If you just want to use metadata ingestion, check the ",Object(r.b)("a",{parentName:"p",href:"/docs/metadata-ingestion"},"user-centric")," guide."),Object(r.b)("h2",{id:"architecture"},"Architecture"),Object(r.b)("p",null,Object(r.b)("img",{alt:"metadata ingestion framework layout",src:n(279).default})),Object(r.b)("p",null,"The architecture of this metadata ingestion framework is heavily inspired by ",Object(r.b)("a",{parentName:"p",href:"https://gobblin.apache.org/"},"Apache Gobblin")," (also originally a LinkedIn project!). We have a standardized format - the MetadataChangeEvent - and sources and sinks which respectively produce and consume these objects. The sources pull metadata from a variety of data systems, while the sinks are primarily for moving this metadata into DataHub."),Object(r.b)("h2",{id:"getting-started"},"Getting Started"),Object(r.b)("h3",{id:"requirements"},"Requirements"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Python 3.6+ must be installed in your host environment."),Object(r.b)("li",{parentName:"ol"},"You also need to build the ",Object(r.b)("inlineCode",{parentName:"li"},"mxe-schemas")," module as below.",Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",{parentName:"pre"},"(cd .. && ./gradlew :metadata-events:mxe-schemas:build)\n")),"This is needed to generate ",Object(r.b)("inlineCode",{parentName:"li"},"MetadataChangeEvent.avsc")," which is the schema for the ",Object(r.b)("inlineCode",{parentName:"li"},"MetadataChangeEvent_v4")," Kafka topic."),Object(r.b)("li",{parentName:"ol"},"On MacOS: ",Object(r.b)("inlineCode",{parentName:"li"},"brew install librdkafka")),Object(r.b)("li",{parentName:"ol"},"On Debian/Ubuntu: ",Object(r.b)("inlineCode",{parentName:"li"},"sudo apt install librdkafka-dev python3-dev python3-venv")),Object(r.b)("li",{parentName:"ol"},"On Fedora (if using LDAP source integration): ",Object(r.b)("inlineCode",{parentName:"li"},"sudo yum install openldap-devel"))),Object(r.b)("h3",{id:"set-up-your-python-environment"},"Set up your Python environment"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"python3 -m venv venv\nsource venv/bin/activate\npip install --upgrade pip==20.2.4 wheel setuptools\npip uninstall datahub || true ; rm -r src/*.egg-info || true\npip install -e .\n./scripts/codegen.sh\n")),Object(r.b)("h3",{id:"common-setup-issues"},"Common setup issues"),Object(r.b)("p",null,"Common issues (click to expand):"),Object(r.b)("details",null,Object(r.b)("summary",null,"datahub command not found with PyPI install"),Object(r.b)("p",null,"If you've already run the pip install, but running ",Object(r.b)("inlineCode",{parentName:"p"},"datahub")," in your command line doesn't work, then there is likely an issue with your PATH setup and Python."),Object(r.b)("p",null,"The easiest way to circumvent this is to install and run via Python, and use ",Object(r.b)("inlineCode",{parentName:"p"},"python3 -m datahub")," in place of ",Object(r.b)("inlineCode",{parentName:"p"},"datahub"),"."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"python3 -m pip install acryl-datahub\npython3 -m datahub --help\n"))),Object(r.b)("details",null,Object(r.b)("summary",null,'Wheel issues e.g. "Failed building wheel for avro-python3" or "error: invalid command \'bdist_wheel\'"'),Object(r.b)("p",null,"This means Python's ",Object(r.b)("inlineCode",{parentName:"p"},"wheel")," is not installed. Try running the following commands and then retry."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"pip install --upgrade pip==20.2.4 wheel setuptools\npip cache purge\n"))),Object(r.b)("details",null,Object(r.b)("summary",null,"Failure to install confluent_kafka: \"error: command 'x86_64-linux-gnu-gcc' failed with exit status 1\""),Object(r.b)("p",null,"This sometimes happens if there's a version mismatch between the Kafka's C library and the Python wrapper library. Try running ",Object(r.b)("inlineCode",{parentName:"p"},"pip install confluent_kafka==1.5.0")," and then retrying.")),Object(r.b)("h3",{id:"using-plugins-in-development"},"Using Plugins in Development"),Object(r.b)("p",null,"The syntax for installing plugins is slightly different in development. For example:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-diff"},"- pip install 'acryl-datahub[bigquery,datahub-rest]'\n+ pip install -e '.[bigquery,datahub-rest]'\n")),Object(r.b)("h2",{id:"code-layout"},"Code layout"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"The CLI interface is defined in ",Object(r.b)("a",{parentName:"li",href:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/src/datahub/entrypoints.py"},"entrypoints.py"),"."),Object(r.b)("li",{parentName:"ul"},"The high level interfaces are defined in the ",Object(r.b)("a",{parentName:"li",href:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/src/datahub/ingestion/api"},"API directory"),"."),Object(r.b)("li",{parentName:"ul"},"The actual ",Object(r.b)("a",{parentName:"li",href:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/src/datahub/ingestion/source"},"sources")," and ",Object(r.b)("a",{parentName:"li",href:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/src/datahub/ingestion/sink"},"sinks")," have their own directories. The registry files in those directories import the implementations."),Object(r.b)("li",{parentName:"ul"},"The metadata models are created using code generation, and eventually live in the ",Object(r.b)("inlineCode",{parentName:"li"},"./src/datahub/metadata")," directory. However, these files are not checked in and instead are generated at build time. See the ",Object(r.b)("a",{parentName:"li",href:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/scripts/codegen.sh"},"codegen")," script for details."),Object(r.b)("li",{parentName:"ul"},"Tests live in the ",Object(r.b)("a",{parentName:"li",href:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/tests"},Object(r.b)("inlineCode",{parentName:"a"},"tests"))," directory. They're split between smaller unit tests and larger integration tests.")),Object(r.b)("h2",{id:"contributing"},"Contributing"),Object(r.b)("p",null,"Contributions welcome!"),Object(r.b)("h3",{id:"testing"},"Testing"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"# Follow standard install from source procedure - see above.\n\n# Install, including all dev requirements.\npip install -e '.[dev]'\n\n# Run unit tests.\npytest tests/unit\n\n# Run integration tests. Note that the integration tests require docker.\npytest tests/integration\n")),Object(r.b)("h3",{id:"sanity-check-code-before-committing"},"Sanity check code before committing"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-sh"},"# Assumes: pip install -e '.[dev]'\nblack .\nisort .\nflake8 .\nmypy .\npytest\n")))}u.isMDXComponent=!0},163:function(e,t,n){"use strict";function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}n.d(t,"a",(function(){return a}))},164:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}n.d(t,"a",(function(){return a}))},165:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=i.a.createContext({}),u=function(e){var t=i.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=u(e.components);return i.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},p=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),p=a,m=d["".concat(o,".").concat(p)]||d[p]||b[p]||r;return n?i.a.createElement(m,l(l({ref:t},c),{},{components:n})):i.a.createElement(m,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<r;c++)o[c]=n[c];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},279:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/datahub-metadata-ingestion-framework-17ea65cd4913f08cb69942bf3a41eb1d.png"}}]);