(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{117:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"metadata",(function(){return a})),t.d(n,"rightToc",(function(){return l})),t.d(n,"default",(function(){return d}));var o=t(159),r=t(160),i=(t(0),t(161)),c={title:"Using Docker Images During Development",hide_title:!0,slug:"/docker/development",custom_edit_url:"https://github.com/linkedin/datahub/blob/master/docs/docker/development.md"},a={unversionedId:"docs/docker/development",id:"docs/docker/development",isDocsHomePage:!1,title:"Using Docker Images During Development",description:"Using Docker Images During Development",source:"@site/genDocs/docs/docker/development.md",slug:"/docker/development",permalink:"/docs/docker/development",editUrl:"https://github.com/linkedin/datahub/blob/master/docs/docker/development.md",version:"current",sidebar:"overviewSidebar",previous:{title:"Developer's Guide",permalink:"/docs/developers"},next:{title:"What is GMA graph?",permalink:"/docs/what/graph"}},l=[{value:"Debugging",id:"debugging",children:[]},{value:"Tips for People New To Docker",id:"tips-for-people-new-to-docker",children:[]},{value:"Accessing Logs",id:"accessing-logs",children:[{value:"Conflicting containers",id:"conflicting-containers",children:[]},{value:"Running a specific service",id:"running-a-specific-service",children:[]}]}],s={rightToc:l};function d(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(o.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"using-docker-images-during-development"},"Using Docker Images During Development"),Object(i.b)("p",null,"We've created a special ",Object(i.b)("inlineCode",{parentName:"p"},"docker-compose.dev.yml")," override file that should configure docker images to be easier to use\nduring development."),Object(i.b)("p",null,"Normally, you'd rebuild your images from scratch with ",Object(i.b)("inlineCode",{parentName:"p"},"docker-compose build")," (or ",Object(i.b)("inlineCode",{parentName:"p"},"docker-compose up --build"),"). However,\nthis takes way too long for development. It has to copy the entire repo to each image and rebuild it there."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"docker-compose.dev.yml")," file bypasses this problem by mounting binaries, startup scripts, and other data to\nspecial, slimmed down images (of which the Dockerfile is usually defined in ",Object(i.b)("inlineCode",{parentName:"p"},"<service>/debug/Dockerfile"),"). "),Object(i.b)("p",null,"These dev images will use your ",Object(i.b)("em",{parentName:"p"},"locally built code"),", so you'll need to build locally with gradle first\n(and every time you want to update the instance). Building locally should be much faster than building on Docker."),Object(i.b)("p",null,"We highly recommend you just invoke the ",Object(i.b)("inlineCode",{parentName:"p"},"docker/dev.sh")," script we've included. It is pretty small if you want to read it\nto see what it does, but it ends up using our ",Object(i.b)("inlineCode",{parentName:"p"},"docker-compose.dev.yml")," file."),Object(i.b)("h2",{id:"debugging"},"Debugging"),Object(i.b)("p",null,"The default dev images, while set up to use your local code, do not enable debugging by default. To enable debugging,\nyou need to make two small edits (don't check these changes in!)."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Add the JVM debug flags to the environment file for the service."),Object(i.b)("li",{parentName:"ul"},"Assign the port in the docker-compose file.")),Object(i.b)("p",null,"For example, to debug ",Object(i.b)("inlineCode",{parentName:"p"},"datahub-gms"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sh"},"# Add this line to docker/datahub-gms/env/docker.env. You can change the port and/or change suspend=n to y.\nJAVA_TOOL_OPTIONS=-agentlib:jdwp=transport=dt_socket,address=5005,server=y,suspend=n\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yml"},'# Change the definition in docker/docker-compose.dev.yml to this\n  datahub-gms:\n    image: linkedin/datahub-gms:debug\n    build:\n      context: datahub-gms/debug\n      dockerfile: Dockerfile\n    ports:             # <--- Add this line\n      - "5005:5005"    # <--- And this line. Must match port from environment file.\n    volumes:\n      - ./datahub-gms/start.sh:/datahub/datahub-gms/scripts/start.sh\n      - ../gms/war/build/libs/:/datahub/datahub-gms/bin\n')),Object(i.b)("h2",{id:"tips-for-people-new-to-docker"},"Tips for People New To Docker"),Object(i.b)("h2",{id:"accessing-logs"},"Accessing Logs"),Object(i.b)("p",null,"It is highly recommended you use ",Object(i.b)("a",{parentName:"p",href:"https://www.docker.com/products/docker-desktop"},"Docker Desktop's dashboard")," to access service logs. If you double click an image it will pull up the logs for you."),Object(i.b)("h3",{id:"conflicting-containers"},"Conflicting containers"),Object(i.b)("p",null,"If you ran ",Object(i.b)("inlineCode",{parentName:"p"},"docker/quickstart.sh")," before, your machine may already have a container for DataHub. If you want to run\n",Object(i.b)("inlineCode",{parentName:"p"},"docker/dev.sh")," instead, ensure that the old container is removed by running ",Object(i.b)("inlineCode",{parentName:"p"},"docker container prune"),". The opposite also\napplies."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Note this only removes containers, not images. Should still be fast to switch between these once you've launched both\nat least once.")),Object(i.b)("h3",{id:"running-a-specific-service"},"Running a specific service"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"docker-compose up")," will launch all services in the configuration, including dependencies, unless they're already\nrunning. If you, for some reason, wish to change this behavior, check out these example commands."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"docker-compose -p datahub -f docker-compose.yml -f docker-compose.overrides.yml -f docker-compose.dev.yml up datahub-gms\n")),Object(i.b)("p",null,"Will only start ",Object(i.b)("inlineCode",{parentName:"p"},"datahub-gms")," and its dependencies."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"docker-compose -p datahub -f docker-compose.yml -f docker-compose.override.yml -f docker-compose.dev.yml up --no-deps datahub-gms\n")),Object(i.b)("p",null,"Will only start ",Object(i.b)("inlineCode",{parentName:"p"},"datahub-gms"),", without dependencies."))}d.isMDXComponent=!0},159:function(e,n,t){"use strict";function o(){return(o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}t.d(n,"a",(function(){return o}))},160:function(e,n,t){"use strict";function o(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}t.d(n,"a",(function(){return o}))},161:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return m}));var o=t(0),r=t.n(o);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=r.a.createContext({}),d=function(e){var n=r.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=d(e.components);return r.a.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},b=r.a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=d(t),b=o,m=u["".concat(c,".").concat(b)]||u[b]||p[b]||i;return t?r.a.createElement(m,a(a({ref:n},s),{},{components:t})):r.a.createElement(m,a({ref:n},s))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,c=new Array(i);c[0]=b;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a.mdxType="string"==typeof e?e:o,c[1]=a;for(var s=2;s<i;s++)c[s]=t[s];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);