(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{138:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return l}));var n=a(158),r=a(159),i=(a(0),a(160)),o={title:"Metadata Ingestion Architecture",hide_title:!0,slug:"/architecture/metadata-ingestion",custom_edit_url:"https://github.com/linkedin/datahub/blob/master/docs/architecture/metadata-ingestion.md"},c={unversionedId:"docs/architecture/metadata-ingestion",id:"docs/architecture/metadata-ingestion",isDocsHomePage:!1,title:"Metadata Ingestion Architecture",description:"Metadata Ingestion Architecture",source:"@site/genDocs/docs/architecture/metadata-ingestion.md",slug:"/architecture/metadata-ingestion",permalink:"/docs/architecture/metadata-ingestion",editUrl:"https://github.com/linkedin/datahub/blob/master/docs/architecture/metadata-ingestion.md",version:"current",sidebar:"overviewSidebar",previous:{title:"Architecture Overview",permalink:"/docs/architecture/architecture"},next:{title:"What is Generalized Metadata Architecture (GMA)?",permalink:"/docs/what/gma"}},s=[{value:"MCE Consumer Job",id:"mce-consumer-job",children:[]},{value:"MAE Consumer Job",id:"mae-consumer-job",children:[]},{value:"Search and Graph Index Builders",id:"search-and-graph-index-builders",children:[]}],d={rightToc:s};function l(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},d,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h1",{id:"metadata-ingestion-architecture"},"Metadata Ingestion Architecture"),Object(i.b)("h2",{id:"mce-consumer-job"},"MCE Consumer Job"),Object(i.b)("p",null,"Metadata providers communicate changes in metadata by emitting ",Object(i.b)("a",{parentName:"p",href:"/docs/what/mxe#metadata-change-event-mce"},"MCE"),"s, which are consumed by a Kafka Streams job, ",Object(i.b)("a",{parentName:"p",href:"https://github.com/linkedin/datahub/blob/master/metadata-jobs/mce-consumer-job"},"mce-consumer-job"),". The ",Object(i.b)("a",{parentName:"p",href:"/docs/metadata-ingestion"},"Python ingestion framework")," makes it easy to emit these MCEs.\nThe MCE consumer job converts the AVRO-based MCE into the equivalent ",Object(i.b)("a",{parentName:"p",href:"https://linkedin.github.io/rest.li/how_data_is_represented_in_memory#the-data-template-layer"},"Pegasus Data Template")," and saves it into the database by calling a special GMS ingest API."),Object(i.b)("h2",{id:"mae-consumer-job"},"MAE Consumer Job"),Object(i.b)("p",null,"All the emitted ",Object(i.b)("a",{parentName:"p",href:"/docs/what/mxe#metadata-audit-event-mae"},"MAE")," will be consumed by a Kafka Streams job, ",Object(i.b)("a",{parentName:"p",href:"https://github.com/linkedin/datahub/blob/master/metadata-jobs/mae-consumer-job"},"mae-consumer-job"),", which updates the ",Object(i.b)("a",{parentName:"p",href:"/docs/what/graph"},"graph")," and ",Object(i.b)("a",{parentName:"p",href:"/docs/what/search-index"},"search index")," accordingly.\nThe job itself is entity-agnostic and will execute corresponding graph & search index builders, which will be invoked by the job when a specific metadata aspect is changed.\nThe builder should instruct the job how to update the graph and search index based on the metadata change.\nThe builder can optionally use ",Object(i.b)("a",{parentName:"p",href:"/docs/architecture/metadata-serving#remote-dao"},"Remote DAO")," to fetch additional metadata from other sources to help compute the final update."),Object(i.b)("p",null,"To ensure that metadata changes are processed in the correct chronological order,\nMAEs are keyed by the entity ",Object(i.b)("a",{parentName:"p",href:"/docs/what/urn"},"URN")," \u2014 meaning all MAEs for a particular entity will be processed sequentially by a single Kafka streams thread. "),Object(i.b)("h2",{id:"search-and-graph-index-builders"},"Search and Graph Index Builders"),Object(i.b)("p",null,"As described in ",Object(i.b)("a",{parentName:"p",href:"/docs/how/metadata-modelling"},"Metadata Modelling")," section, ",Object(i.b)("a",{parentName:"p",href:"/docs/what/entity"},"Entity"),", ",Object(i.b)("a",{parentName:"p",href:"/docs/what/relationship"},"Relationship"),", and ",Object(i.b)("a",{parentName:"p",href:"/docs/what/search-document"},"Search Document")," models do not directly encode the logic of how each field should be derived from metadata.\nInstead, this logic should be provided in the form of a graph or search index builder."),Object(i.b)("p",null,"The builders register the metadata ",Object(i.b)("a",{parentName:"p",href:"/docs/what/aspect"},"aspect"),"s of their interest against ",Object(i.b)("a",{parentName:"p",href:"#mae-consumer-job"},"MAE Consumer Job")," and will be invoked whenever a MAE involving the corresponding aspect is received.\nIf the MAE itself doesn\u2019t contain all the metadata needed, builders can use Remote DAO to fetch from GMS directly."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"public abstract class BaseIndexBuilder<DOCUMENT extends RecordTemplate> {\n\n BaseIndexBuilder(@Nonnull List<Class<? extends RecordTemplate>> snapshotsInterested);\n\n @Nullable\n public abstract List<DOCUMENT> getDocumentsToUpdate(@Nonnull RecordTemplate snapshot);\n\n @Nonnull\n public abstract Class<DOCUMENT> getDocumentType();\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-java"},"public interface GraphBuilder<SNAPSHOT extends RecordTemplate> {\n GraphUpdates build(SNAPSHOT snapshot);\n\n @Value\n class GraphUpdates {\n   List<? extends RecordTemplate> entities;\n   List<RelationshipUpdates> relationshipUpdates;\n }\n\n @Value\n class RelationshipUpdates {\n   List<? extends RecordTemplate> relationships;\n   BaseGraphWriterDAO.RemovalOption preUpdateOperation;\n }\n}\n")))}l.isMDXComponent=!0},158:function(e,t,a){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}a.d(t,"a",(function(){return n}))},159:function(e,t,a){"use strict";function n(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}a.d(t,"a",(function(){return n}))},160:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return b}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=r.a.createContext({}),l=function(e){var t=r.a.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},u=function(e){var t=l(e.components);return r.a.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},h=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(a),h=n,b=u["".concat(o,".").concat(h)]||u[h]||p[h]||i;return a?r.a.createElement(b,c(c({ref:t},d),{},{components:a})):r.a.createElement(b,c({ref:t},d))}));function b(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=h;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,o[1]=c;for(var d=2;d<i;d++)o[d]=a[d];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);