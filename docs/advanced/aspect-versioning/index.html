<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2G54RXWD4D"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2G54RXWD4D",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="DataHub" href="/opensearch.xml"><title data-react-helmet="true">Aspect Versioning | DataHub</title><meta data-react-helmet="true" property="og:url" content="https://datahubproject.io/docs/advanced/aspect-versioning"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Aspect Versioning | DataHub"><meta data-react-helmet="true" name="description" content="As each version of metadata aspect is immutable, any update to an existing aspect results in the creation of a new version. Typically one would expect the version number increases sequentially with the largest version number being the latest version, i.e. v1 (oldest), v2 (second oldest), ..., vN (latest). However, this approach results in major challenges in both rest.li modeling &amp; transaction isolation and therefore requires a rethinking."><meta data-react-helmet="true" property="og:description" content="As each version of metadata aspect is immutable, any update to an existing aspect results in the creation of a new version. Typically one would expect the version number increases sequentially with the largest version number being the latest version, i.e. v1 (oldest), v2 (second oldest), ..., vN (latest). However, this approach results in major challenges in both rest.li modeling &amp; transaction isolation and therefore requires a rethinking."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://datahubproject.io/docs/advanced/aspect-versioning"><link data-react-helmet="true" rel="alternate" href="https://datahubproject.io/docs/advanced/aspect-versioning" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://datahubproject.io/docs/advanced/aspect-versioning" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.e90a37b3.css">
<link rel="preload" href="/assets/js/runtime~main.b387d183.js" as="script">
<link rel="preload" href="/assets/js/main.3d3b283f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo-color.png" alt="DataHub Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.png" alt="DataHub Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">DataHub</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a class="navbar__item navbar__link" href="/docs/demo">Demo</a><a class="navbar__item navbar__link" href="/docs/saas">SaaS</a><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo-color.png" alt="DataHub Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.png" alt="DataHub Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">DataHub</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a class="menu__link" href="/docs/demo">Demo</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/saas">SaaS</a></li><li class="menu__list-item"><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DataHub</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features">Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing">Contributing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/demo">Demo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/saas">SaaS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/releases">Releases</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/quickstart">Quickstart Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/debugging">Debugging Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-ingestion">Metadata Ingestion</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/architecture/architecture">Architecture Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/architecture/metadata-ingestion">Metadata Ingestion Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/architecture/metadata-serving">Serving Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-web-react">React App</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Metadata Modeling</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-modeling/metadata-model">The Metadata Model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-modeling/extending-the-metadata-model">Extending the Metadata Model</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/developers">Developer&#x27;s Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docker/development">Using Docker Images During Development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-ingestion/adding-source">Adding a Metadata Ingestion Source</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-ingestion/s3-ingestion">Ingesting files from S3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how/auth/jaas">JaaS Authentication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how/auth/sso/configure-oidc-react">OIDC Authentication in React</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how/auth/sso/configure-oidc-react-google">Configuring Google Authentication for React App (OIDC)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how/auth/sso/configure-oidc-react-okta">Configuring Okta Authentication for React App (OIDC)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how/restore-indices">Restoring Search and Graph Indices from Local Database</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-web-react/src/app/analytics">React Analytics</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-web-react">React App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-frontend">Frontend</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-graphql-core">GraphQL Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gms">Generalized Metadata Store (GMS)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-gms-graphql-service">GMS GraphQL Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-jobs/mae-consumer-job">MetadataAuditEvent (MAE) Consumer Job</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-jobs/mce-consumer-job">MetadataChangeEvent (MCE) Consumer Job</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-ingestion/developing">Developing on Metadata Ingestion</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Advanced Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/no-code-modeling">No Code Metadata</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/advanced/aspect-versioning">Aspect Versioning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/es-7-upgrade">Elasticsearch upgrade from 5.6.8 to 7.9.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/high-cardinality">High Cardinality Relationships</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/scsi-onboarding-guide">Strongly Consistent Secondary Index</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/no-code-upgrade">No Code Upgrade (In-Place Migration Guide)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/migrating-graph-service-implementation">Migrate Graph Service Implementation to Elasticsearch</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how/kafka-config">Configuring Kafka</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docker">Deploying with Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deploy/kubernetes">Deploying with Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docker/datahub-upgrade">Upgrade Docker Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deploy/aws">Deploying to AWS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deploy/gcp">Deploying to GCP</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/slack">Slack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/links">Articles &amp; Talks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/townhalls">Town Halls</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/townhall-history">Town Hall History</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/code_of_conduct">Contributor Covenant Code of Conduct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc">RFC Process</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">RFCs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1778-dashboards">Dashboards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1812-ml_models">Machine Learning Models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1820-azkaban-flow-job">Azkaban Flows and Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1841-lineage/field_level_lineage">RFC - Field Level Lineage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1842-business_glossary">Business Glossary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/2042-graphql_frontend/queries">GraphQL Frontend (Part 1)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/2055-react-app">Proposal to Incubate a new React Application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/tags">Tags</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Aspect Versioning</h1></header><p>As each version of <a href="/docs/what/aspect">metadata aspect</a> is immutable, any update to an existing aspect results in the creation of a new version. Typically one would expect the version number increases sequentially with the largest version number being the latest version, i.e. <code>v1</code> (oldest), <code>v2</code> (second oldest), ..., <code>vN</code> (latest). However, this approach results in major challenges in both rest.li modeling &amp; transaction isolation and therefore requires a rethinking.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="restli-modeling"></a>Rest.li Modeling<a class="hash-link" href="#restli-modeling" title="Direct link to heading">#</a></h2><p>As it&#x27;s common to create dedicated rest.li sub-resources for a specific aspect, e.g. <code>/datasets/{datasetKey}/ownership</code>, the concept of versions become an interesting modeling question. Should the sub-resource be a <a href="https://linkedin.github.io/rest.li/modeling/modeling#simple" target="_blank" rel="noopener noreferrer">Simple</a> or a <a href="https://linkedin.github.io/rest.li/modeling/modeling#collection" target="_blank" rel="noopener noreferrer">Collection</a> type?</p><p>If Simple, the <a href="https://linkedin.github.io/rest.li/user_guide/restli_server#get" target="_blank" rel="noopener noreferrer">GET</a> method is expected to return the latest version, and the only way to retrieve non-latest versions is through a custom <a href="https://linkedin.github.io/rest.li/user_guide/restli_server#action" target="_blank" rel="noopener noreferrer">ACTION</a> method, which is going against the <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener noreferrer">REST</a> principle. As a result, a Simple sub-resource doesn&#x27;t seem to a be a good fit.</p><p>If Collection, the version number naturally becomes the key so it&#x27;s easy to retrieve specific version number using the typical GET method. It&#x27;s also easy to list all versions using the standard <a href="https://linkedin.github.io/rest.li/user_guide/restli_server#get_all" target="_blank" rel="noopener noreferrer">GET_ALL</a> method or get a set of versions via <a href="https://linkedin.github.io/rest.li/user_guide/restli_server#batch_get" target="_blank" rel="noopener noreferrer">BATCH_GET</a>. However, Collection resources don&#x27;t support a simple way to get the latest/largest key directly. To achieve that, one must do one of the following</p><ul><li>a GET_ALL (assuming descending key order) with a page size of 1</li><li>a <a href="https://linkedin.github.io/rest.li/user_guide/restli_server#finder" target="_blank" rel="noopener noreferrer">FINDER</a> with special parameters and a page size of 1</li><li>a custom ACTION method again</li></ul><p>None of these options seems like a natural way to ask for the latest version of an aspect, which is one of the most common use cases.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transaction-isolation"></a>Transaction Isolation<a class="hash-link" href="#transaction-isolation" title="Direct link to heading">#</a></h2><p><a href="https://en.wikipedia.org/wiki/Isolation_(database_systems)" target="_blank" rel="noopener noreferrer">Transaction isolation</a> is a complex topic so make sure to familiarize yourself with the basics first. </p><p>To support concurrent update of a metadata aspect, the following pseudo DB operations must be run in a single transaction,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1. Retrieve the current max version (Vmax)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2. Write the new value as (Vmax + 1)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Operation 1 above can easily suffer from <a href="https://en.wikipedia.org/wiki/Isolation_(database_systems)#Phantom_reads" target="_blank" rel="noopener noreferrer">Phantom Reads</a>. This subsequently leads to Operation 2 computing the incorrect version and thus overwrites an existing version instead of creating a new one.</p><p>One way to solve this is by enforcing <a href="https://en.wikipedia.org/wiki/Isolation_(database_systems)#Serializable" target="_blank" rel="noopener noreferrer">Serializable</a> isolation level in DB at the <a href="https://logicalread.com/optimize-mysql-perf-part-2-mc13/#.XjxSRSlKh1N" target="_blank" rel="noopener noreferrer">cost of performance</a>. In reality, very few DB even supports this level of isolation, especially for distributed document stores. It&#x27;s more common to support <a href="https://en.wikipedia.org/wiki/Isolation_(database_systems)#Repeatable_reads" target="_blank" rel="noopener noreferrer">Repeatable Reads</a> or <a href="https://en.wikipedia.org/wiki/Isolation_(database_systems)#Read_committed" target="_blank" rel="noopener noreferrer">Read Committed</a> isolation levelsâ€”sadly neither would help in this case.</p><p>Another possible solution is to transactionally keep track of <code>Vmax</code> directly in a separate table to avoid the need to compute that through a <code>select</code> (thus prevent Phantom Reads). However, cross-table/document/entity transaction is not a feature supported by all distributed document stores, which precludes this as a generalized solution.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="solution-version-0"></a>Solution: Version 0<a class="hash-link" href="#solution-version-0" title="Direct link to heading">#</a></h2><p>The solution to both challenges turns out to be surprisingly simple. Instead of using a &quot;floating&quot; version number to represent the latest version, one can use a &quot;fixed/sentinel&quot; version number instead. In this case we choose Version 0 as we want all non-latest versions to still keep increasing sequentially. In other words, it&#x27;d be <code>v0</code> (latest), <code>v1</code> (oldest), <code>v2</code> (second oldest), etc. Alternatively, you can also simply view all the non-zero versions as an audit trail.</p><p>Let&#x27;s examine how Version 0 can solve the aforementioned challenges.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="restli-modeling-1"></a>Rest.li Modeling<a class="hash-link" href="#restli-modeling-1" title="Direct link to heading">#</a></h3><p>With Version 0, getting the latest version becomes calling the GET method of a Collection aspect-specific sub-resource with a deterministic key, e.g. <code>/datasets/{datasetkey}/ownership/0</code>, which is a lot more natural than using GET_ALL or FINDER.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transaction-isolation-1"></a>Transaction Isolation<a class="hash-link" href="#transaction-isolation-1" title="Direct link to heading">#</a></h3><p>The pseudo DB operations change to the following transaction block with version 0,</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1. Retrieve v0 of the aspect</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2. Retrieve the current max version (Vmax)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3. Write the old value back as (Vmax + 1)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4. Write the new value back as v0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>While Operation 2 still suffers from potential Phantom Reads and thus corrupting existing version in Operation 3, Repeatable Reads isolation level will ensure that the transaction fails due to <a href="https://codingsight.com/the-lost-update-problem-in-concurrent-transactions/" target="_blank" rel="noopener noreferrer">Lost Update</a> detected in Operation 4. Note that this happens to also be the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html" target="_blank" rel="noopener noreferrer">default isolation level</a> for InnoDB in MySQL.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/linkedin/datahub/blob/master/docs/advanced/aspect-versioning.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/advanced/no-code-modeling"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« No Code Metadata</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/advanced/es-7-upgrade"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Elasticsearch upgrade from 5.6.8 to 7.9.3 Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#restli-modeling" class="table-of-contents__link">Rest.li Modeling</a></li><li><a href="#transaction-isolation" class="table-of-contents__link">Transaction Isolation</a></li><li><a href="#solution-version-0" class="table-of-contents__link">Solution: Version 0</a><ul><li><a href="#restli-modeling-1" class="table-of-contents__link">Rest.li Modeling</a></li><li><a href="#transaction-isolation-1" class="table-of-contents__link">Transaction Isolation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/quickstart">Quickstart</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/features">Features</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC3qFQC5IiwR5fvWEqi_tJ5w" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/townhalls">Town Halls</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/#adoption">Adoption</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/demo">Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/roadmap">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">Contributing</a></li><li class="footer__item"><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2015-2021 DataHub Project Authors.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b387d183.js"></script>
<script src="/assets/js/main.3d3b283f.js"></script>
</body>
</html>