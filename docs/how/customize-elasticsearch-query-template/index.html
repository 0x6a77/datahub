<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2G54RXWD4D"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2G54RXWD4D",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="DataHub" href="/opensearch.xml"><title data-react-helmet="true">How to customize the search experience of an entity? | DataHub</title><meta data-react-helmet="true" property="og:url" content="https://datahubproject.io/docs/how/customize-elasticsearch-query-template"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How to customize the search experience of an entity? | DataHub"><meta data-react-helmet="true" name="description" content="Assume you have all the fields needed for your query, otherwise, refer to this doc if you&#x27;re only interested in indexing a new field of an existing entity"><meta data-react-helmet="true" property="og:description" content="Assume you have all the fields needed for your query, otherwise, refer to this doc if you&#x27;re only interested in indexing a new field of an existing entity"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://datahubproject.io/docs/how/customize-elasticsearch-query-template"><link data-react-helmet="true" rel="alternate" href="https://datahubproject.io/docs/how/customize-elasticsearch-query-template" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://datahubproject.io/docs/how/customize-elasticsearch-query-template" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.96c35e2c.css">
<link rel="preload" href="/assets/js/runtime~main.7af95817.js" as="script">
<link rel="preload" href="/assets/js/main.97223f69.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo-color.png" alt="DataHub Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.png" alt="DataHub Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">DataHub</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Slack</a><a class="navbar__item navbar__link" href="/docs/demo">Demo</a><a class="navbar__item navbar__link" href="/docs/saas">SaaS</a><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo-color.png" alt="DataHub Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo-dark.png" alt="DataHub Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">DataHub</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="menu__link">Slack</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/demo">Demo</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/saas">SaaS</a></li><li class="menu__list-item"><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">How to customize the search experience of an entity?</h1></header><div class="markdown"><blockquote><p>Assume you have all the fields needed for your query, otherwise, refer to <a href="/docs/how/search-over-new-field">this doc</a> if you&#x27;re only interested in indexing a new field of an existing entity </p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-default-query-template-for-each-type-of-search-document"></a>1. Default query template for each type of search document<a class="hash-link" href="#1-default-query-template-for-each-type-of-search-document" title="Direct link to heading">#</a></h2><p>The search query is constructed and executed through <a href="/docs/architecture/metadata-serving#search-dao">Search DAO</a>. Each search document is associated with a customizable query template, which can found <a href="https://github.com/linkedin/datahub/tree/master/gms/impl/src/main/resources" target="_blank" rel="noopener noreferrer">here</a>.
Take <a href="https://github.com/linkedin/datahub/blob/master/gms/impl/src/main/resources/datasetESSearchQueryTemplate.json" target="_blank" rel="noopener noreferrer">dataset search query template</a> for example, it supports a few features:</p><p>The general search accepts a query and at run time, <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao-impl/elasticsearch-dao/src/main/java/com/linkedin/metadata/dao/search/ESSearchDAO.java" target="_blank" rel="noopener noreferrer">ES Search DAO</a> will replace $INPUT in the query template and generate the query for Elasticsearch.
For example, in search bar, user can type in &quot;test&quot; to find all the related datasets with its name matching the rules defined in query template.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;query_string&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;query&quot;: &quot;$INPUT&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;analyzer&quot;: &quot;whitespace_lowercase&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;boost&quot;: 0.125,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;default_field&quot;: &quot;name.ngram&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;default_operator&quot;: &quot;AND&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The advanced search for dataset in DataHub is implemented by <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer">query string query</a>.
This query uses a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-query-string-query.html#query-string-syntax" target="_blank" rel="noopener noreferrer">syntax</a> to parse and split the provided query string based on operators, such as AND or NOT. The query then analyzes each split text independently before returning matching documents.
You can use the query_string query to create a complex search that includes wildcard characters, searches across multiple fields, and more. While versatile, the query is strict and returns an error if the query string includes any invalid syntax.
For example, in search bar, user can type in &quot;platform:kafka&quot; to get all kafka datasets or &quot;owners:foo AND platform:hdfs&quot; to get all the hdfs datasets owned by foo.</p><p>Relevance is achieved with <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-function-score-query.html" target="_blank" rel="noopener noreferrer">function score query</a> and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/mapping-boost.html" target="_blank" rel="noopener noreferrer">boost</a>.
For example, the template sets high scores for those that have owners, and set lower scores for those that are deprecated.  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> &quot;functions&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &quot;filter&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &quot;term&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           &quot;hasOwners&quot;: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &quot;weight&quot;: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &quot;filter&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         &quot;term&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           &quot;deprecated&quot;: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       &quot;weight&quot;: 0.5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     }, ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-elasticsearch-full-text-queries"></a>2. Elasticsearch full text queries<a class="hash-link" href="#2-elasticsearch-full-text-queries" title="Direct link to heading">#</a></h2><p>Elasticsearch provides a full Query DSL (Domain Specific Language) based on JSON to define queries. If the default query template does not suit your business need, you may want to explore more about <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/full-text-queries.html" target="_blank" rel="noopener noreferrer">Elasticsearch full text queries</a>
Here are several popular ones:
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer">match query</a> accepts text/numerics/dates, analyzes them, and constructs a query.
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-multi-match-query.html" target="_blank" rel="noopener noreferrer">multi_match query</a> builds on the match query to allow multi-field queries
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer">query_string_query</a> is a query that uses a query parser in order to parse its content.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-analyzers"></a>3. Analyzers<a class="hash-link" href="#3-analyzers" title="Direct link to heading">#</a></h2><p>Text analysis enables Elasticsearch to perform full-text search, where the search returns all relevant results rather than just exact matches.
Text analysis is performed by an <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/analyzer.html" target="_blank" rel="noopener noreferrer">analyzer</a>, a set of rules that govern the entire process. Elasticsearch includes a default analyzer, called the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/analysis-standard-analyzer.html" target="_blank" rel="noopener noreferrer">standard analyzer</a>, which works well for most use cases right out of the box.
If you want to tailor your search experience, you can choose a different built-in analyzer or even configure a custom one. A custom analyzer gives you control over each step of the analysis process.  </p><p>You can check a list of custom analyzers in settings in <a href="https://github.com/linkedin/datahub/blob/master/docker/elasticsearch-setup/dataset-index-config.json" target="_blank" rel="noopener noreferrer">dataset index config</a>
Analyzers can be specified per-query, per-field or per-index. Read more about analyzer <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/analyzer.html" target="_blank" rel="noopener noreferrer">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-language-support"></a>4. Language support<a class="hash-link" href="#4-language-support" title="Direct link to heading">#</a></h2><p>You can apply one of the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/analysis-lang-analyzer.html" target="_blank" rel="noopener noreferrer">language analyzers</a> supported by Elasticsearch.
For languages such as Chinese and Japanese, you would need to install <a href="https://www.elastic.co/guide/en/elasticsearch/plugins/5.6/analysis-smartcn.html" target="_blank" rel="noopener noreferrer">Smart Chinese Analysis plugin</a> or
<a href="https://www.elastic.co/guide/en/elasticsearch/plugins/5.6/analysis-kuromoji.html" target="_blank" rel="noopener noreferrer">Japanese Analysis plugin</a> first. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-test-raw-queries-against-elasticsearch"></a>5. Test raw queries against Elasticsearch<a class="hash-link" href="#5-test-raw-queries-against-elasticsearch" title="Direct link to heading">#</a></h2><p>You can first run the raw query to check if the results are expected. Below are some sample queries:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl http://localhost:9200/datasetdocument/_search? -d &#x27;{&quot;query&quot;: {&quot;match&quot;: {&quot;name&quot;: &quot;test_datasetname&quot;}}}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl http://localhost:9200/datasetdocument/_search? -d &#x27;{&quot;query&quot;:{&quot;query_string&quot;:{&quot;query&quot;:&quot;name:test_datasetname&quot;}}}&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the results look good, you can move on to the next step:</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-test-search-rest-api"></a>6. Test search rest API<a class="hash-link" href="#6-test-search-rest-api" title="Direct link to heading">#</a></h2><p>Example query: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">curl &#x27;http://localhost:8080/datasets?q=search&amp;input=test_datasetname&#x27; </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If the results look good, you can move on to the next step if needed. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="7-test-end-to-end"></a>7. Test end to end<a class="hash-link" href="#7-test-end-to-end" title="Direct link to heading">#</a></h2><p>Search via data hub UI. Debugging into mid-tier or UI if the results look different. </p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/linkedin/datahub/blob/master/docs/how/customize-elasticsearch-query-template.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-default-query-template-for-each-type-of-search-document" class="table-of-contents__link">1. Default query template for each type of search document</a></li><li><a href="#2-elasticsearch-full-text-queries" class="table-of-contents__link">2. Elasticsearch full text queries</a></li><li><a href="#3-analyzers" class="table-of-contents__link">3. Analyzers</a></li><li><a href="#4-language-support" class="table-of-contents__link">4. Language support</a></li><li><a href="#5-test-raw-queries-against-elasticsearch" class="table-of-contents__link">5. Test raw queries against Elasticsearch</a></li><li><a href="#6-test-search-rest-api" class="table-of-contents__link">6. Test search rest API</a></li><li><a href="#7-test-end-to-end" class="table-of-contents__link">7. Test end to end</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/quickstart">Quickstart</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/features">Features</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC3qFQC5IiwR5fvWEqi_tJ5w" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/townhalls">Town Halls</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/#adoption">Adoption</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/demo">Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/roadmap">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">Contributing</a></li><li class="footer__item"><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2015-2021 DataHub Project Authors.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7af95817.js"></script>
<script src="/assets/js/main.97223f69.js"></script>
</body>
</html>