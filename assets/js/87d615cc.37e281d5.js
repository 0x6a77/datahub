(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[4791],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return s},kt:function(){return m}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var d=n.createContext({}),u=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},s=function(e){var t=u(e.components);return n.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,d=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),c=u(a),m=o,h=c["".concat(d,".").concat(m)]||c[m]||p[m]||r;return a?n.createElement(h,i(i({ref:t},s),{},{components:a})):n.createElement(h,i({ref:t},s))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=c;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var u=2;u<r;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},2415:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return i},metadata:function(){return l},toc:function(){return d},default:function(){return s}});var n=a(2122),o=a(9756),r=(a(7294),a(3905)),i={title:"No Code Upgrade (In-Place Migration Guide)",sidebar_label:"No Code Upgrade (In-Place Migration Guide)",slug:"/advanced/no-code-upgrade",custom_edit_url:"https://github.com/linkedin/datahub/blob/master/docs/advanced/no-code-upgrade.md"},l={unversionedId:"docs/advanced/no-code-upgrade",id:"docs/advanced/no-code-upgrade",isDocsHomePage:!1,title:"No Code Upgrade (In-Place Migration Guide)",description:"Summary of changes",source:"@site/genDocs/docs/advanced/no-code-upgrade.md",sourceDirName:"docs/advanced",slug:"/advanced/no-code-upgrade",permalink:"/docs/advanced/no-code-upgrade",editUrl:"https://github.com/linkedin/datahub/blob/master/docs/advanced/no-code-upgrade.md",version:"current",sidebar_label:"No Code Upgrade (In-Place Migration Guide)",frontMatter:{title:"No Code Upgrade (In-Place Migration Guide)",sidebar_label:"No Code Upgrade (In-Place Migration Guide)",slug:"/advanced/no-code-upgrade",custom_edit_url:"https://github.com/linkedin/datahub/blob/master/docs/advanced/no-code-upgrade.md"},sidebar:"overviewSidebar",previous:{title:"How to onboard to Strongly Consistent Secondary Index (SCSI)?",permalink:"/docs/how/scsi-onboarding-guide"},next:{title:"How to configure Kafka?",permalink:"/docs/how/kafka-config"}},d=[{value:"Summary of changes",id:"summary-of-changes",children:[]},{value:"Migration strategy",id:"migration-strategy",children:[]},{value:"Upgrade Steps",id:"upgrade-steps",children:[{value:"Step 1: Pull &amp; deploy latest container images",id:"step-1-pull--deploy-latest-container-images",children:[]},{value:"Step 2: Execute Migration Job",id:"step-2-execute-migration-job",children:[]},{value:"Step 3 (Optional): Cleaning Up",id:"step-3-optional-cleaning-up",children:[]}]},{value:"Support",id:"support",children:[]}],u={toc:d};function s(e){var t=e.components,a=(0,o.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"summary-of-changes"},"Summary of changes"),(0,r.kt)("p",null,"With the No Code metadata initiative, we've introduced various major changes:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"New Ebean Aspect table (metadata_aspect_v2)"),(0,r.kt)("li",{parentName:"ol"},"New Elastic Indices (",(0,r.kt)("em",{parentName:"li"},"entityName"),"index_v2)"),(0,r.kt)("li",{parentName:"ol"},"New edge triples. (Remove fully qualified classpaths from nodes & edges)"),(0,r.kt)("li",{parentName:"ol"},"Dynamic DataPlatform entities (no more hardcoded DataPlatformInfo.json)"),(0,r.kt)("li",{parentName:"ol"},"Dynamic Browse Paths (no more hardcoded browse path creation logic)"),(0,r.kt)("li",{parentName:"ol"},"Addition of Entity Key aspects, dropped requirement for strongly-typed Urns."),(0,r.kt)("li",{parentName:"ol"},"Addition of @Entity, @Aspect, @Searchable, @Relationship annotations to existing models.")),(0,r.kt)("p",null,"Because of these changes, it is required that your persistence layer be migrated after the NoCode containers have been\ndeployed."),(0,r.kt)("p",null,"For more information about the No Code Update, please see ",(0,r.kt)("a",{parentName:"p",href:"/docs/advanced/no-code-modeling"},"no-code-modeling"),"."),(0,r.kt)("h2",{id:"migration-strategy"},"Migration strategy"),(0,r.kt)("p",null,"We are merging these breaking changes into the main branch upfront because we feel they are fundamental to subsequent\nchanges, providing a more solid foundation upon which exciting new features will be built upon. We will continue to\noffer limited support for previous verions of DataHub."),(0,r.kt)("p",null,"This approach means that companies who actively deploy the latest version of DataHub will need to perform an upgrade to\ncontinue operating DataHub smoothly."),(0,r.kt)("h2",{id:"upgrade-steps"},"Upgrade Steps"),(0,r.kt)("h3",{id:"step-1-pull--deploy-latest-container-images"},"Step 1: Pull & deploy latest container images"),(0,r.kt)("p",null,"It is important that the following containers are pulled and deployed simultaneously:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"datahub-frontend-react"),(0,r.kt)("li",{parentName:"ul"},"datahub-gms"),(0,r.kt)("li",{parentName:"ul"},"datahub-mae-consumer"),(0,r.kt)("li",{parentName:"ul"},"datahub-mce-consumer")),(0,r.kt)("h4",{id:"docker-compose-deployments"},"Docker Compose Deployments"),(0,r.kt)("p",null,"From the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker")," directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-aidl"},"docker-compose down --remove-orphans && docker-compose pull && docker-compose -p datahub up --force-recreate\n")),(0,r.kt)("h4",{id:"helm"},"Helm"),(0,r.kt)("p",null,"Deploying latest helm charts will upgrade all components to version 0.8.0. Once all the pods are up and running, it will\nrun the datahub-upgrade job, which will run the above docker container to migrate to the new sources."),(0,r.kt)("h3",{id:"step-2-execute-migration-job"},"Step 2: Execute Migration Job"),(0,r.kt)("h4",{id:"docker-compose-deployments-1"},"Docker Compose Deployments"),(0,r.kt)("p",null,"The easiest option is to execute the ",(0,r.kt)("inlineCode",{parentName:"p"},"run_upgrade.sh")," script located under ",(0,r.kt)("inlineCode",{parentName:"p"},"docker/datahub-upgrade/nocode"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd docker/datahub-upgrade/nocode\n./run_upgrade.sh\n")),(0,r.kt)("p",null,"In both cases, the default environment variables will be used (",(0,r.kt)("inlineCode",{parentName:"p"},"docker/datahub-upgrade/env/docker.env"),"). These assume\nthat your deployment is local. If this is not the case, you'll need to define your own environment variables to tell the\nupgrade system where your DataHub containers reside."),(0,r.kt)("p",null,"You can either"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Change ",(0,r.kt)("inlineCode",{parentName:"li"},"docker/datahub-upgrade/env/docker.env")," in place and then run one of the above commands OR"),(0,r.kt)("li",{parentName:"ol"},'Define a new ".env" file containing your variables and\nexecute ',(0,r.kt)("inlineCode",{parentName:"li"},"docker pull acryldata/datahub-upgrade && docker run acryldata/datahub-upgrade:latest -u NoCodeDataMigration"))),(0,r.kt)("p",null,"To see the required environment variables, see the (datahub-upgrade)","[../../docker/datahub-upgrade/README.md]","\ndocumentation"),(0,r.kt)("h5",{id:"how-to-fix-the-listening-to-port-5005-issue"},'How to fix the "listening to port 5005" issue'),(0,r.kt)("p",null,"Fix for this issue have been published to the acryldata/datahub-upgrade:head tag. Please pull latest master and rerun\nthe upgrade script."),(0,r.kt)("p",null,"However, we have seen cases where the problematic docker image is cached and docker does not pull the latest version. If\nthe script fails with the same error after pulling latest master, please run the following command to clear the docker\nimage cache."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"docker images -a | grep acryldata/datahub-upgrade | awk '{print $3}' | xargs docker rmi -f\n")),(0,r.kt)("h4",{id:"helm-deployments"},"Helm Deployments"),(0,r.kt)("p",null,"Upgrade to latest helm charts by running the following after pulling latest master."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-(shell)"},"helm upgrade datahub datahub/ --values datahub/quickstart-values.yaml\n")),(0,r.kt)("p",null,"This will upgrade all pods to version 0.8.0, and once all pods are up and ready, datahub-upgrade job will start, running\nthe above docker image to migrate to the new stores."),(0,r.kt)("h3",{id:"step-3-optional-cleaning-up"},"Step 3 (Optional): Cleaning Up"),(0,r.kt)("p",null,"This step involves removing data from previous versions of DataHub. This step should only be performed once you've\nvalidated that your DataHub deployment is healthy after performing the upgrade. If you're able to search, browse, and\nview your Metadata after the upgrade steps have been completed, you should be in good shape."),(0,r.kt)("p",null,"In advanced DataHub deployments, or cases in which you cannot easily rebuild the state stored in DataHub, it is strongly\nadvised that you do due diligence prior to running cleanup. This may involve manually inspecting the relational tables (\nmetadata_aspect_v2), search indices, and graph topology."),(0,r.kt)("h4",{id:"docker-compose-deployments-2"},"Docker Compose Deployments"),(0,r.kt)("p",null,"The easiest option is to execute the ",(0,r.kt)("inlineCode",{parentName:"p"},"run_clean.sh")," script located under ",(0,r.kt)("inlineCode",{parentName:"p"},"docker/datahub-upgrade/nocode"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd docker/datahub-upgrade/nocode\n./run_clean.sh\n")),(0,r.kt)("p",null,"In both cases, the default environment variables will be used (",(0,r.kt)("inlineCode",{parentName:"p"},"docker/datahub-upgrade/env/docker.env"),"). These assume\nthat your deployment is local. If this is not the case, you'll need to define your own environment variables to tell the\nupgrade system where your DataHub containers reside."),(0,r.kt)("p",null,"You can either"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Change ",(0,r.kt)("inlineCode",{parentName:"li"},"docker/datahub-upgrade/env/docker.env")," in place and then run one of the above commands OR"),(0,r.kt)("li",{parentName:"ol"},'Define a new ".env" file containing your variables and execute\n',(0,r.kt)("inlineCode",{parentName:"li"},"docker pull acryldata/datahub-upgrade && docker run acryldata/datahub-upgrade:latest -u NoCodeDataMigrationCleanup"))),(0,r.kt)("p",null,"To see the required environment variables, see the (datahub-upgrade)","[../../docker/datahub-upgrade/README.md]","\ndocumentation"),(0,r.kt)("h4",{id:"helm-deployments-1"},"Helm Deployments"),(0,r.kt)("p",null,"TODO"),(0,r.kt)("h2",{id:"support"},"Support"),(0,r.kt)("p",null,"The Acryl team will be on standby to assist you in your migration. Please\njoin ",(0,r.kt)("a",{parentName:"p",href:"https://datahubspace.slack.com/archives/C0244FHMHJQ"},"#release-0_8_0")," channel and reach out to us if you find\ntrouble with the upgrade or have feedback on the process. We will work closely to make sure you can continue to operate\nDataHub smoothly."))}s.isMDXComponent=!0}}]);