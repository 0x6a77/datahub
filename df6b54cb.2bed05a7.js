(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{144:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return i})),a.d(t,"rightToc",(function(){return o})),a.d(t,"default",(function(){return u}));var r=a(163),n=a(164),s=(a(0),a(165)),c={title:"How to customize the search experience of an entity?",hide_title:!0,slug:"/how/customize-elasticsearch-query-template",custom_edit_url:"https://github.com/linkedin/datahub/blob/master/docs/how/customize-elasticsearch-query-template.md"},i={unversionedId:"docs/how/customize-elasticsearch-query-template",id:"docs/how/customize-elasticsearch-query-template",isDocsHomePage:!1,title:"How to customize the search experience of an entity?",description:"How to customize the search experience of an entity?",source:"@site/genDocs/docs/how/customize-elasticsearch-query-template.md",slug:"/how/customize-elasticsearch-query-template",permalink:"/docs/how/customize-elasticsearch-query-template",editUrl:"https://github.com/linkedin/datahub/blob/master/docs/how/customize-elasticsearch-query-template.md",version:"current",sidebar:"overviewSidebar",previous:{title:"Metadata Service Developer Guide",permalink:"/docs/how/build-metadata-service"},next:{title:"How to onboard an entity?",permalink:"/docs/how/entity-onboarding"}},o=[{value:"1. Default query template for each type of search document",id:"1-default-query-template-for-each-type-of-search-document",children:[]},{value:"2. Elasticsearch full text queries",id:"2-elasticsearch-full-text-queries",children:[]},{value:"3. Analyzers",id:"3-analyzers",children:[]},{value:"4. Language support",id:"4-language-support",children:[]},{value:"5. Test raw queries against Elasticsearch",id:"5-test-raw-queries-against-elasticsearch",children:[]},{value:"6. Test search rest API",id:"6-test-search-rest-api",children:[]},{value:"7. Test end to end",id:"7-test-end-to-end",children:[]}],l={rightToc:o};function u(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(s.b)("wrapper",Object(r.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(s.b)("h1",{id:"how-to-customize-the-search-experience-of-an-entity"},"How to customize the search experience of an entity?"),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"Assume you have all the fields needed for your query, otherwise, refer to ",Object(s.b)("a",{parentName:"p",href:"/docs/how/search-over-new-field"},"this doc")," if you're only interested in indexing a new field of an existing entity ")),Object(s.b)("h2",{id:"1-default-query-template-for-each-type-of-search-document"},"1. Default query template for each type of search document"),Object(s.b)("p",null,"The search query is constructed and executed through ",Object(s.b)("a",{parentName:"p",href:"/docs/architecture/metadata-serving#search-dao"},"Search DAO"),". Each search document is associated with a customizable query template, which can found ",Object(s.b)("a",{parentName:"p",href:"https://github.com/linkedin/datahub/tree/master/gms/impl/src/main/resources"},"here"),".\nTake ",Object(s.b)("a",{parentName:"p",href:"https://github.com/linkedin/datahub/blob/master/gms/impl/src/main/resources/datasetESSearchQueryTemplate.json"},"dataset search query template")," for example, it supports a few features:"),Object(s.b)("p",null,"The general search accepts a query and at run time, ",Object(s.b)("a",{parentName:"p",href:"https://github.com/linkedin/datahub/blob/master/metadata-dao-impl/elasticsearch-dao/src/main/java/com/linkedin/metadata/dao/search/ESSearchDAO.java"},"ES Search DAO"),' will replace $INPUT in the query template and generate the query for Elasticsearch.\nFor example, in search bar, user can type in "test" to find all the related datasets with its name matching the rules defined in query template.'),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},'  {\n    "query_string": {\n      "query": "$INPUT",\n      "analyzer": "whitespace_lowercase",\n      "boost": 0.125,\n      "default_field": "name.ngram",\n      "default_operator": "AND"\n    }\n  }...\n')),Object(s.b)("p",null,"The advanced search for dataset in DataHub is implemented by ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-query-string-query.html"},"query string query"),".\nThis query uses a ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-query-string-query.html#query-string-syntax"},"syntax"),' to parse and split the provided query string based on operators, such as AND or NOT. The query then analyzes each split text independently before returning matching documents.\nYou can use the query_string query to create a complex search that includes wildcard characters, searches across multiple fields, and more. While versatile, the query is strict and returns an error if the query string includes any invalid syntax.\nFor example, in search bar, user can type in "platform:kafka" to get all kafka datasets or "owners:foo AND platform:hdfs" to get all the hdfs datasets owned by foo.'),Object(s.b)("p",null,"Relevance is achieved with ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-function-score-query.html"},"function score query")," and ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/mapping-boost.html"},"boost"),".\nFor example, the template sets high scores for those that have owners, and set lower scores for those that are deprecated.  "),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},' "functions": [\n     {\n       "filter": {\n         "term": {\n           "hasOwners": true\n         }\n       },\n       "weight": 2\n     },\n     {\n       "filter": {\n         "term": {\n           "deprecated": true\n         }\n       },\n       "weight": 0.5\n     }, ...\n')),Object(s.b)("h2",{id:"2-elasticsearch-full-text-queries"},"2. Elasticsearch full text queries"),Object(s.b)("p",null,"Elasticsearch provides a full Query DSL (Domain Specific Language) based on JSON to define queries. If the default query template does not suit your business need, you may want to explore more about ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/full-text-queries.html"},"Elasticsearch full text queries"),"\nHere are several popular ones:\n",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-match-query.html"},"match query")," accepts text/numerics/dates, analyzes them, and constructs a query.\n",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-multi-match-query.html"},"multi_match query")," builds on the match query to allow multi-field queries\n",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/query-dsl-query-string-query.html"},"query_string_query")," is a query that uses a query parser in order to parse its content."),Object(s.b)("h2",{id:"3-analyzers"},"3. Analyzers"),Object(s.b)("p",null,"Text analysis enables Elasticsearch to perform full-text search, where the search returns all relevant results rather than just exact matches.\nText analysis is performed by an ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/analyzer.html"},"analyzer"),", a set of rules that govern the entire process. Elasticsearch includes a default analyzer, called the ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/analysis-standard-analyzer.html"},"standard analyzer"),", which works well for most use cases right out of the box.\nIf you want to tailor your search experience, you can choose a different built-in analyzer or even configure a custom one. A custom analyzer gives you control over each step of the analysis process.  "),Object(s.b)("p",null,"You can check a list of custom analyzers in settings in ",Object(s.b)("a",{parentName:"p",href:"https://github.com/linkedin/datahub/blob/master/docker/elasticsearch-setup/dataset-index-config.json"},"dataset index config"),"\nAnalyzers can be specified per-query, per-field or per-index. Read more about analyzer ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/analyzer.html"},"here"),"."),Object(s.b)("h2",{id:"4-language-support"},"4. Language support"),Object(s.b)("p",null,"You can apply one of the ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/reference/5.6/analysis-lang-analyzer.html"},"language analyzers")," supported by Elasticsearch.\nFor languages such as Chinese and Japanese, you would need to install ",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/plugins/5.6/analysis-smartcn.html"},"Smart Chinese Analysis plugin")," or\n",Object(s.b)("a",{parentName:"p",href:"https://www.elastic.co/guide/en/elasticsearch/plugins/5.6/analysis-kuromoji.html"},"Japanese Analysis plugin")," first. "),Object(s.b)("h2",{id:"5-test-raw-queries-against-elasticsearch"},"5. Test raw queries against Elasticsearch"),Object(s.b)("p",null,"You can first run the raw query to check if the results are expected. Below are some sample queries:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},'curl http://localhost:9200/datasetdocument/_search? -d \'{"query": {"match": {"name": "test_datasetname"}}}\'\ncurl http://localhost:9200/datasetdocument/_search? -d \'{"query":{"query_string":{"query":"name:test_datasetname"}}}\'\n')),Object(s.b)("p",null,"If the results look good, you can move on to the next step:"),Object(s.b)("h2",{id:"6-test-search-rest-api"},"6. Test search rest API"),Object(s.b)("p",null,"Example query: "),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},"curl 'http://localhost:8080/datasets?q=search&input=test_datasetname' \n")),Object(s.b)("p",null,"If the results look good, you can move on to the next step if needed. "),Object(s.b)("h2",{id:"7-test-end-to-end"},"7. Test end to end"),Object(s.b)("p",null,"Search via data hub UI. Debugging into mid-tier or UI if the results look different. "))}u.isMDXComponent=!0},163:function(e,t,a){"use strict";function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}a.d(t,"a",(function(){return r}))},164:function(e,t,a){"use strict";function r(e,t){if(null==e)return{};var a,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}a.d(t,"a",(function(){return r}))},165:function(e,t,a){"use strict";a.d(t,"a",(function(){return h})),a.d(t,"b",(function(){return m}));var r=a(0),n=a.n(r);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=n.a.createContext({}),u=function(e){var t=n.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},h=function(e){var t=u(e.components);return n.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},d=n.a.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,c=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),h=u(a),d=r,m=h["".concat(c,".").concat(d)]||h[d]||p[d]||s;return a?n.a.createElement(m,i(i({ref:t},l),{},{components:a})):n.a.createElement(m,i({ref:t},l))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,c=new Array(s);c[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:r,c[1]=i;for(var l=2;l<s;l++)c[l]=a[l];return n.a.createElement.apply(null,c)}return n.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);